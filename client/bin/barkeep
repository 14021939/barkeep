#!/usr/bin/env ruby

require "rubygems"
require "dedent"
require "yaml"

require "barkeep/commit"
require "barkeep/configuration"
require "barkeep/unapproved"

COMMANDS = {
  "commit" => "Get information about a particular commit.",
  "unapproved" => "Find unapproved commits from a list or commit range."
}

sub_command = ARGV.shift
unless COMMANDS.include? sub_command
  puts sub_command ? "Error: unrecognized command '#{sub_command}'" : "Error: must provide command."
  puts <<-EOS.dedent

    Usage:
        $ barkeep <command> [args]
    where <command> is one of:
  EOS
  COMMANDS.each { |command, purpose| puts "    #{command.rjust(COMMANDS.keys.map(&:size).max)} | #{purpose}" }
  puts <<-EOS.dedent

    Type 'barkeep <command> --help' for more information about a particular command.
  EOS
  exit 1
end

begin
  configuration = BarkeepClient.get_configuration
rescue RuntimeError => e
  puts e.message
  exit 1
end

# Delegate to the trollop parsing + client logic that lives in the appropriate subcommand file.
BarkeepClient::Commands.send sub_command.to_sym, configuration
